<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/css/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/build/ol.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
    
    <style>
      .map {
        height: 600px;
        width: 100%;
      }
      #map {
        position: relative;
      }
      #info {
        position: absolute;
        height: 1px;
        width: 1px;
        z-index: 100;
      }
      .tooltip.in {
        opacity: 1;
      }
      .tooltip.top .tooltip-arrow {
        border-top-color: white;
      }
      .tooltip-inner {
        border: 2px solid white;
      }
    </style>

  </head>
  <body>
    <div id="map" class="map"><div id="info"></div></div>
    
    <script type="text/javascript">
      const styleFunction = function (feature) {
   	   return new ol.style.Style({
   	      image: new ol.style.Circle({
   	        radius: 8,
   	        fill: new ol.style.Fill({
   	          color: 'rgba(55, 53, 255, 0.4)',
   	        }),
   	        stroke: new ol.style.Stroke({
   	          color: 'rgba(255, 204, 0, 0.2)',
   	          width: 1,
   	        }),
   	      }),
   	    });
      }
    
      const map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          }),
          new ol.layer.Vector({
            source: new ol.source.Vector({
              url: "supporters.kml",
              format: new ol.format.KML({
                  extractStyles: false,
              })
            }),
            style: styleFunction
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([-87.62, 41.87]),
          zoom: 2
        })
      });
      
      const info = $('#info');
      info.tooltip({
        animation: false,
        trigger: 'manual',
      });

      const displayFeatureInfo = function (pixel) {
        info.css({
          left: pixel[0] + 'px',
          top: pixel[1] - 15 + 'px',
        });
        const feature = map.forEachFeatureAtPixel(pixel, function (feature) {
          return feature;
        });
        if (feature) {
          info.attr('data-original-title', feature.get('name')).tooltip('show');
        } else {
          info.tooltip('hide');
        }
      };
      
      map.on('pointermove', function (evt) {
    	  if (evt.dragging) {
    	    info.tooltip('hide');
    	    return;
    	  }
    	  displayFeatureInfo(map.getEventPixel(evt.originalEvent));
    	});

      map.on('click', function (evt) {
    	  displayFeatureInfo(evt.pixel);
    	});
    </script>
  </body>
</html>